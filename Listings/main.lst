C51 COMPILER V9.60.0.0   MAIN                                                              05/13/2020 14:05:38 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <reg51.h>
   2          
   3          void LCD_Init (void);
   4          void delay(unsigned int count);
   5          void LCD_Command (unsigned char cmd);
   6          void LCD_Char (unsigned char char_data);
   7          void LCD_String (unsigned char *str);
   8          void LCD_String_xy (char row, char pos, char *str);
   9          void Counter(unsigned short int lengthSeconds, unsigned char displayCount);
  10          
  11          sfr lcd_data_port=0x90;         /* P1 port as data port */
  12          sbit rs=P2^0;                   /* Register select pin */
  13          sbit rw=P2^1;                   /* Read/Write pin */
  14          sbit en=P2^2;                   /* Enable pin */
  15          
  16          //sbits for lights
  17          sbit ewG = P0^0;
  18          sbit ewY = P0^1;
  19          sbit ewR = P0^2;
  20          sbit nsG = P0^3;
  21          sbit nsY = P0^4;
  22          sbit nsR = P0^5;
  23          
  24          
  25          //#define TESTING
  26          unsigned char walkState = 0;
  27          unsigned char trafficSign[] = "Heavy traffic on 405";
  28          
  29          void main()
  30          {
  31   1              unsigned char state = 0;
  32   1              IE = 0x81; //enable external interupt P3.2
  33   1              LCD_Init();
  34   1              
  35   1              while(1){
  36   2                      ewG = 1;
  37   2                      ewY = 1;
  38   2                      ewR = 1;
  39   2                      ewG = 1;
  40   2                      ewY = 1;
  41   2                      ewR = 1;
  42   2                      switch(state){
  43   3                              case 0x00:
  44   3                              {
  45   4                                      nsY = 1;
  46   4                                      ewR = 1;
  47   4                                      ewG = 0;
  48   4                                      nsR = 0;
  49   4                                      //start Counters
  50   4                                      
  51   4                                      if(walkState != 0){
  52   5                                              //display count down
  53   5                                              Counter(0x06, walkState);
  54   5                                              walkState = 0xff;
C51 COMPILER V9.60.0.0   MAIN                                                              05/13/2020 14:05:38 PAGE 2   

  55   5                                      }
  56   4                                      else{
  57   5                                              //display road sign
  58   5                                              Counter(0x06, 0x00);
  59   5                                      }
  60   4                                      state++;
  61   4                              }
  62   3                              case 0x01:
  63   3                              {
  64   4                                      ewG = 1;
  65   4                                      ewY = 0;
  66   4                                      //start Counters
  67   4                                      if(walkState == 0xff){
  68   5                                              //flash
  69   5                                              Counter(0x03, walkState);
  70   5                                              walkState = 0;
  71   5                                      }
  72   4                                      else{
  73   5                                              //display road sign
  74   5                                              Counter(0x03, 0x00);
  75   5                                      }
  76   4                                      state++;
  77   4                              }
  78   3                              case 0x02:
  79   3                              {
  80   4                                      ewY = 1;
  81   4                                      nsG = 0;
  82   4                                      ewR = 0;
  83   4                                      //start Counters
  84   4                                      
  85   4                                      if(walkState != 0){
  86   5                                              //display count down
  87   5                                              Counter(0x06, walkState);
  88   5                                              walkState = 0xff;
  89   5                                      }
  90   4                                      else{
  91   5                                              //display road sign
  92   5                                              Counter(0x06, 0x00);
  93   5                                      }
  94   4                                      state++;
  95   4                              }
  96   3                              case 0x03:
  97   3                              {
  98   4                                      nsG = 1;
  99   4                                      nsY = 0;
 100   4                                      ewR = 0;
 101   4                                      //start Counters
 102   4                                      if(walkState == 0xff){
 103   5                                              //flash
 104   5                                              Counter(0x03, walkState);
 105   5                                              walkState = 0;
 106   5                                      }
 107   4                                      else{
 108   5                                              //display road sign
 109   5                                              Counter(0x03, 0x00);
 110   5                                      }
 111   4                                      state = 0;
 112   4                              }
 113   3                      }
 114   2              }
 115   1      }
 116          
C51 COMPILER V9.60.0.0   MAIN                                                              05/13/2020 14:05:38 PAGE 3   

 117          void walk(void) interrupt 0{
 118   1              walkState = 0x01;
 119   1      }
 120          
 121          void Counter(unsigned short int lengthSeconds, unsigned char walkState)
 122          {
 123   1              int counter;
 124   1              if (walkState != 0){
 125   2                      if(walkState == 0x01){
 126   3                              //count down
 127   3                              counter = 0;
 128   3                              //send byte
 129   3                              //printByte(lengthSeconds - (counter/1000));
 130   3                              LCD_Command (0x01);     //clear display
 131   3                              LCD_Command (0x80); //move cursor to home
 132   3                              LCD_String("print counter");
 133   3                              while(counter < lengthSeconds*1000)
 134   3                              {
 135   4                                      //counter
 136   4                                      TMOD = 0x01;
 137   4                                      TL0 = 0x66;
 138   4                                      TH0 = 0xFC;
 139   4                                      TR0 = 1;
 140   4                                      while(~TF0);
 141   4                                      counter++;
 142   4                                      TF0 = 0;
 143   4                              }
 144   3                              TR0 = 0;
 145   3                      }
 146   2                      else{
 147   3                              //flash
 148   3                              counter = 0;
 149   3                              //flash lcd on-off
 150   3                              LCD_Command (0x01);     //clear display
 151   3                              LCD_Command (0x80); //move cursor to home
 152   3                              LCD_String("flash lcd");
 153   3                              while(counter < lengthSeconds*1000)
 154   3                              {
 155   4                                      //counter
 156   4                                      TMOD = 0x01;
 157   4                                      TL0 = 0x66;
 158   4                                      TH0 = 0xFC;
 159   4                                      TR0 = 1;
 160   4                                      while(~TF0);
 161   4                                      counter++;
 162   4                                      TF0 = 0;
 163   4                              }
 164   3                              TR0 = 0;
 165   3                      }
 166   2              }
 167   1              else{
 168   2                      
 169   2                      counter = 0;
 170   2                      //show road sign
 171   2                      LCD_Command (0x01);     //clear display
 172   2                      LCD_Command (0x80); //move cursor to home
 173   2                      LCD_String("show sign");
 174   2                      while(counter < lengthSeconds*1000)
 175   2                      {
 176   3                              //counter
 177   3                              TMOD = 0x01;
 178   3                              TL0 = 0x66;
C51 COMPILER V9.60.0.0   MAIN                                                              05/13/2020 14:05:38 PAGE 4   

 179   3                              TH0 = 0xFC;
 180   3                              TR0 = 1;
 181   3                              while(~TF0);
 182   3                              counter++;
 183   3                              TF0 = 0;
 184   3                      }
 185   2                      TR0 = 0;
 186   2              }
 187   1      }
 188          
 189          void LCD_Init (void)            /* LCD Initialize function */
 190          {       
 191   1              delay(20);              /* LCD Power ON Initialization time >15ms */
 192   1              LCD_Command (0x38);     /* Initialization of 16X2 LCD in 8bit mode */
 193   1              LCD_Command (0x0C);     /* Display ON Cursor OFF */
 194   1              LCD_Command (0x06);     /* Auto Increment cursor */
 195   1              LCD_Command (0x01);     /* clear display */
 196   1              LCD_Command (0x80);     /* cursor at home position */
 197   1      }
 198          
 199          void delay(unsigned int count)  /* Function to provide delay Approx 1ms */
 200          {
 201   1              int i,j;
 202   1              for(i=0;i<count;i++)
 203   1              for(j=0;j<112;j++);
 204   1      }
 205          
 206          void LCD_Command (unsigned char cmd)  /* LCD16x2 command funtion */
 207          {
 208   1              lcd_data_port= cmd;
 209   1              rs=0;                   /* command reg. */
 210   1              rw=0;                   /* Write operation */
 211   1              en=1; 
 212   1              delay(1);
 213   1              en=0;
 214   1              delay(5);
 215   1      }
 216          
 217          void LCD_Char (unsigned char char_data)  /* LCD data write function */
 218          {
 219   1              lcd_data_port=char_data;
 220   1              rs=1;                   /* Data reg.*/
 221   1              rw=0;                   /* Write operation*/
 222   1              en=1;                                   
 223   1              delay(1);
 224   1              en=0;
 225   1              delay(5);
 226   1      }
 227          
 228          void LCD_String (unsigned char *str) /* Send string to LCD function */
 229          {
 230   1              int i;
 231   1              for(i=0;str[i]!=0;i++)  /* Send each char of string till the NULL */
 232   1              {
 233   2                      LCD_Char (str[i]);  /* Call LCD data write */
 234   2              }
 235   1      }
 236          
 237          void LCD_String_xy (char row, char pos, char *str)  /* Send string to LCD function */
 238          {
 239   1              if (row == 0)
 240   1              LCD_Command((pos & 0x0F)|0x80);
C51 COMPILER V9.60.0.0   MAIN                                                              05/13/2020 14:05:38 PAGE 5   

 241   1              else if (row == 1)
 242   1              LCD_Command((pos & 0x0F)|0xC0);
 243   1              LCD_String(str);        /* Call LCD string function */
 244   1      }
 245          
 246          
 247          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    598    ----
   CONSTANT SIZE    =     34    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     22      15
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
